<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pasapalabra B√≠blico</title>
  <!-- Google Fonts: Open Sans -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden;
      background: url('https://files.123freevectors.com/wp-content/original/119254-abstract-bright-blue-background-graphic-design.jpg') no-repeat center/cover;
      font-family: 'Open Sans', sans-serif;
    }
    /* Banner inicial */
    #banner { position:absolute; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.7); color:#fff; display:flex;
      flex-direction:column; justify-content:center; align-items:center;
      z-index:10; text-align:center; padding:2vmin;
    }
    #banner h2 { font-size:4vmin; margin-bottom:2vmin; }
    #banner p { font-size:2.5vmin; margin-bottom:4vmin; line-height:1.2; }
    #btn-start { background:#4CAF50; color:#fff; border:none;
      padding:1vmin 3vmin; font-size:3vmin; border-radius:0.5vmin; cursor:pointer;
    }
    #btn-start:hover { opacity:0.8; }
    /* Juego oculto hasta inicio */
    #game { display:none; position:relative; width:100vw; height:100vh; }
    /* Ajuste rosco y c√°mara: m√°s peque√±o y hacia arriba */
    #rosco {
      position:absolute;
      width:50vmin; height:50vmin;
      top:40%; left:50%; transform:translate(-50%,-50%);
      border-radius:50%; overflow:hidden; border:4px solid #fff;
      z-index:2; background:rgba(0,0,0,0.2);
    }
    #rosco video { position:absolute; top:0; left:0; width:100%; height:100%;
      object-fit:cover; z-index:1; transform:scaleX(-1); transform-origin:center;
    }
    .letter { position:absolute; width:7vmin; height:7vmin; line-height:7vmin;
      border:3px solid #fff; border-radius:50%; background:rgba(34,34,34,0.8);
      color:#fff; text-align:center; cursor:pointer; user-select:none;
      font-weight:700; font-size:4vmin; z-index:3;
    }
    .letter.correct { background:#4CAF50; }
    .letter.wrong { background:#F44336; }
    .letter.passed { background:#FF9800; }
    /* Cron√≥metro y puntuaci√≥n estilo */
    #timer-container { position:absolute; width:12vmin; height:12vmin;
      border-radius:50%; background: radial-gradient(circle at 30% 30%, #ffb74d, #f57c00);
      display:flex; align-items:center; justify-content:center;
      z-index:4; font-size:4vmin; color:#fff; font-weight:bold;
    }
    #score-container { position:absolute; width:12vmin; height:7vmin;
      border-radius:1vmin; background: radial-gradient(circle at 30% 30%, #ffb74d, #f57c00);
      display:flex; align-items:center; justify-content:center;
      z-index:4; font-size:4vmin; color:#fff; font-weight:bold;
    }
    /* Panel de preguntas, bajo el rosco */
    #question-panel {
      position:absolute;
      top:calc(40% + 25vmin + 15vmin);
      left:50%; transform:translateX(-50%);
      width:85%; max-width:90vmin;
      background:rgba(255,255,255,0.9); padding:1vmin 2vmin;
      border-radius:1vmin; z-index:3; box-shadow:0 0 10px rgba(0,0,0,0.5);
    }
    #question-text { font-size:clamp(2vmin,3vw,3vmin); color:#000; text-align:center; margin:0; }
    #answer { display:none; font-size:4vmin; margin-top:1vmin; color:#333; text-align:center; }
    /* Controles inferiores */
    #controls { position:absolute; bottom:2vmin; left:50%; transform:translateX(-50%);
      display:flex; gap:1vmin; z-index:3;
    }
    #controls button { display:flex; align-items:center; justify-content:center;
      padding:1vmin 1.5vmin; font-size:2vmin; cursor:pointer; border:none;
      border-radius:0.5vmin; color:#fff; font-weight:600;
    }
    #btn-switch-camera, #btn-stop, #btn-resume, #btn-reset { background:#888; }
    #btn-show-answer { background:#555; }
    #btn-pass { background:#FF9800; }
    #btn-correct { background:#4CAF50; }
    #btn-wrong { background:#F44336; }
    #controls button:hover { opacity:0.8; }
    .btn-icon { margin-right:0.5vmin; }
  </style>
</head>
<body>
  <div id="banner">
    <h2>Pasapalabra B√≠blico</h2>
    <p>Responde a una pregunta por cada letra del alfabeto.<br>
    Usa los botones para pasar, corregir o ver la respuesta.<br>
    ¬°Tienes 120 segundos para completar el rosco!</p>
    <button id="btn-start">Empezar</button>
  </div>
  <div id="game">
    <div id="rosco"><video id="player" autoplay muted playsinline></video></div>
    <div id="timer-container">120</div>
    <div id="score-container">0</div>
    <div id="question-panel">
      <div id="question-text">Selecciona una letra para empezar</div>
      <div id="answer">Respuesta: <span id="answer-text"></span></div>
    </div>
    <div id="controls">
      <button id="btn-switch-camera"><span class="btn-icon">üîÑüì∑</span></button>
      <button id="btn-stop"><span class="btn-icon">‚ñ†</span></button>
      <button id="btn-resume"><span class="btn-icon">‚ñ∂Ô∏è</span></button>
      <button id="btn-reset"><span class="btn-icon">‚Ü∫</span></button>
      <button id="btn-show-answer"><span class="btn-icon">‚ùì</span>Mostrar</button>
      <button id="btn-pass"><span class="btn-icon">‚è≠Ô∏è</span>Pasar</button>
      <button id="btn-correct"><span class="btn-icon">‚úîÔ∏è</span>Correcto</button>
      <button id="btn-wrong"><span class="btn-icon">‚úñÔ∏è</span>Incorrecto</button>
    </div>
  </div>
  <script>
    const initialTime = 120;
    let timeLeft = initialTime, timerInterval, score = 0;
    let facingMode = 'user';
    const banner = document.getElementById('banner');
    const btnStart = document.getElementById('btn-start');
    const game = document.getElementById('game');
    const rosco = document.getElementById('rosco');
    const questionText = document.getElementById('question-text');
    const answerDiv = document.getElementById('answer');
    const answerText = document.getElementById('answer-text');
    const btnSwitch = document.getElementById('btn-switch-camera');
    const btnShow = document.getElementById('btn-show-answer');
    const btnPass = document.getElementById('btn-pass');
    const btnCorrect = document.getElementById('btn-correct');
    const btnWrong = document.getElementById('btn-wrong');
    const btnStop = document.getElementById('btn-stop');
    const btnResume = document.getElementById('btn-resume');
    const btnReset = document.getElementById('btn-reset');
    const timerEl = document.getElementById('timer-container');
    const scoreEl = document.getElementById('score-container');
    let questionsByLetter = {}, selectedQuestions = {}, currentLetter = null;

    function startCamera() {
      if (window.stream) window.stream.getTracks().forEach(t => t.stop());
      navigator.mediaDevices.getUserMedia({ video: { facingMode }, audio: false })
        .then(stream => { window.stream = stream; document.getElementById('player').srcObject = stream; })
        .catch(err => console.warn('C√°mara no disponible', err));
    }
    btnSwitch.addEventListener('click', () => { facingMode = (facingMode === 'user' ? 'environment' : 'user'); startCamera(); });

    let lettersDrawn = [];
    function drawLetters() {
      lettersDrawn.forEach(el => el.remove()); lettersDrawn = [];
      const letters = Object.keys(questionsByLetter).sort();
      const total = letters.length;
      const vmin = Math.min(window.innerWidth, window.innerHeight) / 100;
      const letterSize = 7 * vmin;
      const rect = rosco.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      const radius = rect.width / 2 + letterSize / 2 + (vmin * 3);
      letters.forEach((L, i) => {
        const angle = (i / total) * 2 * Math.PI - Math.PI / 2;
        const x = centerX + radius * Math.cos(angle) - letterSize / 2;
        const y = centerY + radius * Math.sin(angle) - letterSize / 2;
        const d = document.createElement('div'); d.className = 'letter';
        d.style.width = letterSize + 'px'; d.style.height = letterSize + 'px'; d.style.lineHeight = letterSize + 'px';
        d.style.left = x + 'px'; d.style.top = y + 'px'; d.textContent = L; d.dataset.letter = L;
        d.addEventListener('click', () => selectLetter(L, d)); game.appendChild(d); lettersDrawn.push(d);
      });
    }

    function initGame() {
      Object.keys(questionsByLetter).forEach(L => {
        const arr = questionsByLetter[L]; selectedQuestions[L] = arr[Math.floor(Math.random() * arr.length)];
      });
      drawLetters(); startTimer();
    }

    function selectLetter(L, div) {
      if (!div || div.classList.contains('correct') || div.classList.contains('wrong') || div.classList.contains('passed')) return;
      currentLetter = L; questionText.style.display = 'block'; questionText.textContent = selectedQuestions[L].Pregunta; answerDiv.style.display = 'none';
    }
    btnShow.addEventListener('click', () => {
      if (!currentLetter) return; questionText.style.display = 'none'; answerText.textContent = selectedQuestions[currentLetter].Respuesta; answerDiv.style.display = 'block';
    });
    btnPass.addEventListener('click', () => markLetter('passed'));
    btnCorrect.addEventListener('click', () => markLetter('correct'));
    btnWrong.addEventListener('click', () => markLetter('wrong'));

    function markLetter(status) {
      if (!currentLetter) return; const div = document.querySelector(`.letter[data-letter=\"${currentLetter}\"]`);
      div.classList.remove('correct', 'wrong', 'passed'); div.classList.add(status);
      if (status === 'correct') score += 100; else if (status === 'wrong') score -= 20;
      scoreEl.textContent = score; currentLetter = null;
      questionText.style.display = 'block'; questionText.textContent = 'Selecciona una letra para empezar'; answerDiv.style.display = 'none';
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        timeLeft--; timerEl.textContent = timeLeft;
        if (timeLeft <= 0) { clearInterval(timerInterval); endGame(); }
      }, 1000);
    }
    btnStop.addEventListener('click', () => clearInterval(timerInterval));
    btnResume.addEventListener('click', () => { clearInterval(timerInterval); startTimer(); });
    btnReset.addEventListener('click', () => { clearInterval(timerInterval); timeLeft = initialTime; timerEl.textContent = timeLeft; startTimer(); });
    function endGame() {
      alert(`¬°Tiempo!\nCorrectas: ${score/100}\nIncorrectas: ${document.querySelectorAll('.letter.wrong').length}\nPasadas: ${document.querySelectorAll('.letter.passed').length}\nPuntuaci√≥n: ${score}`);
    }

    fetch('pasapalabra_questions.json')
      .then(res => res.json())
      .then(data => {
        data.forEach(item => {
          const L = item.Letra.toUpperCase();
          questionsByLetter[L] = questionsByLetter[L] || [];
          questionsByLetter[L].push(item);
        });
      });

    btnStart.addEventListener('click', () => {
      banner.style.display = 'none';
      game.style.display = 'block';
      startCamera();
      initGame();
      const divA = document.querySelector('.letter[data-letter="A"]');
      if (divA) selectLetter('A', divA);
      positionIndicators();
    });

    function positionIndicators() {
      const qp = document.getElementById('question-panel').getBoundingClientRect();
      const timer = document.getElementById('timer-container');
      const score = document.getElementById('score-container');
      const vmin = Math.min(window.innerWidth, window.innerHeight) / 100;
      const margin = vmin;
      // Colocar timer centrado verticalmente en el panel
      const timerTop = qp.top + qp.height / 2 - timer.offsetHeight / 2;
      timer.style.top = `${timerTop}px`;
      // Puntuaci√≥n justo debajo del timer con margen
      const scoreTop = timerTop + timer.offsetHeight + margin;
      score.style.top = `${scoreTop}px`;
      // Ambos pegados a la izquierda del panel de preguntas
      const leftPos = qp.left - timer.offsetWidth - margin;
      timer.style.left = `${leftPos}px`;
      score.style.left = `${leftPos}px`;
    }

    window.addEventListener('resize', () => { drawLetters(); positionIndicators(); });('resize', () => { drawLetters(); positionIndicators(); });
  </script>
</body>
</html>
